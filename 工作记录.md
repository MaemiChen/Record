## 待办
### 0. 学习
1. 学习使用livechart的功能实现图表的设计,还可以考虑使用DynamicDataDisplay.ChartPlotter Toolkit等
2. 在数据分析页面需要增加一个切换
3. extend wpf toolkit 新增的控件了解和使用。
4. WPF Master的使用教程查看。

### 1. Tdcs
1. 当程序安装在U盘上的时候，存在问题，无法正常重新安装。
2. 背景颜色使用等。
3. 考虑淡入淡出模式输入会强制跳转值的问题，可以转换为脉冲宽度一致的模式去限制它。
4. 安装时创建快速运行栏快捷键无效？？（innosetup），这个暂时找不到解决点。
5. 驱动程序同步配置配套到tdcs安装包中。驱动程序包可能存在的路径为C:\Users\陈红梅\AppData\Local\Temp\FTDI-Driver
6. 程序优化，优化数据库修改的流程。在后续出厂时如果再需要修改数据库时应该直接修改本地的数据库而不是手动删除。


### 2. 伪刺激
1. 伪刺激的数据数据模糊查找存在问题。（考虑json串的查找）
2. 治疗记录导出问题
3. admin操作员可以自由更改的问题  
4. 单次病人(还有部分的参数不齐全，添加)



## 工作笔记
3.29
1. 深入调试tms2.0的功能

3.28
1. 了解tms的内容和问题解决。
2. 添加了git的使用，将新的程序上传。

3.23
1. 了解C++类型转换static_cast dynamic_cast const_cast reinterpret_cast
2. 复习和深入了解C++ thread
3. 重写tms2.0的socket

3.22
1. 对tms2.0和edan的软件进行测试，和大概的结构分析
2. 对C++ lock进行大概的学习和巩固
3. 对tms2.0进行深入了解和总结，尝试重写tms2.0代码

3.21
1. 对Mep所有函数进行测试,测试完成Mep的所有函数，以及event的intptr的数据解析
2. 解决一个调用StatusChanged的调用需要注意var m = dev.Model()的问题
3. 对Mep的readme进行增加使用说明和注意事项
4. 发现可能存在的问题，在datareceive和datatrigger接收数据时偶发性的出现inf nan

3.17
1. 了解

3.16
1. 填写伪刺激软著相对应的文档
2. 已完成伪刺激的软著
3. MepSharp的完成，需要回到公司后进行测试

3.15
1. 和同事沟通mepsharp的使用方法，书写了mep使用文档,
2. MepSharp.dll必须在C++sdk环境下运行，尝试解决这个问题。
2. 书写伪刺激软著，（添加源代码部分）


3.14
1. 需要完成CIL的dll包装，api说明和测试代码
2. 修改C#代码中必须UpdateModel()函数必须设置string的值的问题。
3. 书写了一个demo，用来测试Mep。
4. 对于OnTrigger和OnDataChanged 来的数据IntPtr进行数据转换。

3.11
1. 完成了使用CLI来进行mep的C++dll包装。（完成了部分测试）
2. 在C#中使用event来替换C++的函数指针（已完成基础的函数的测试）
3. 修改MepCharp中的命名规范和书写相关的注释。

3.10
1. 完成了使用CLI来进行mep的C++dll包装

3.9
1. 注释了tms2.0的一些打印显示
2. 通过socket或hid跑通了tms2.0的内容框架。（需要自己重新书写及梳理内部逻辑）
3. 学习使用CppSharp自动转换C++文件为C#的库文件内容(只能在.entcoreApp中使用)
4. 了解使用CIL中间语言转换C++库文件，然后在C#中使用。
5. 尝试使用swig来转换C++代码。（暂时未成功）

3.8
1. 

3.7
1. 解决了cmake在第二次运行时一直报错 FindFirstFileExA的问题。解决：项目目录中包含中文
2. 了解C++标准库 cassert cctype cerrno cfloat cinttypes ciso646 climits clocale cmath csetjmp 的各种函数和宏。

3. (TDCS)修改了电流偏置的范围为-500 ~ 500（2022/3/7）


3.4
1. 了解了std::chrono标准库
2. cmake的基础语法信息。

3.3
1. 了解tms2.0的工作原理和代码前置声明和函数指针等信息。
2. 对于TMS_API的所有cmake指令进行了了解和清理。
3. 了解一部分的第三方库的使用情况。

3.2
1. MEP的绑定事件和函数交互大概的逻辑。
2. 尝试使用MEP动态链接库，使用成功。
3. 大概了解TMS的功能交互
    - （Patient、Solution  （load、toObject json）） 
    - （device）主机状态
    - （tms）网络通信socket
4. 了解了一部分cmake的部分体系组织。 

3.1
1. wpf_master 学习
2. 了解TMS_API的操作流程和框架信息。(配置环境)

2.28
1. 当触发状态改变时，向下位机发送设置包修改trigger。
2. 当刺激模式改变时，脉冲宽度和脉冲周期的值越界问题解决
3. wpf_master 4-6个学习

2.25
1. 修复bug。当不连接中继器的时候设置触发模式失败的问题。
2. 修复bug。当连接上中继器时缩放到手动缩小到一定比例会卡死的问题。
3. 优化，当设置触发模式和实际状态包的更新存在时延，增加一个时间进行判断，如果时延超过200ms仍然设置的触发和实际的触发不一致的时候设置的触发失败。

2.24
1. 嵌入式修改了通信协议。然后增加了一个外部触发。当外部触发选中时，开始按钮隐藏设置按钮启动，仅可以设置通道信息。同时外部触发改变时，往下位机下发一个触发命令包。将状态包回复的触发命令信息实时更新显示到界面上。并验证相应的代码修改结果。

2.18
1. 研究了一下innosetup安装时创建快速运行栏快捷键无效的原因。（暂时没找到错误原因）
2. 驱动程序同步安装配套。（未解决）
3. 为方案参数输入越界的TextBox添加错误提示，并适应中英文环境，修改每一个textbox一个定义为一个通用的定义。

2.17
1. 完成了对于治疗记录中同步患者信息的方式修改，由sync_id的属性修改为直接的patient_id
2. 当我修改了Visual stdio时，绿盾会加密，导致程序无法调试。找到问题点并解决。
2.16
1. 数据验证的解决方案总结和blog记录。
2.15
1. NumTextBox后台修改它的最大值，这样可以避免最大值binding的时候初始化错误。
2. 后续还是修改validation来提示限制box输入。在需要相互影响的模块使用带参数的validation

当前发布一个新版本：
- 伪刺激下淡入淡出限制
- 脉冲宽度等不能手动输入数据的问题解决（考虑使用了NumTextBox或者重新使用带参数的Validation）

2.14
1. 完成了一个仅输入数字的TextBox的自定义，功能有
    - 最大值
    - 最小值
    - 数据间隔tick
    - 数据验证错误时的红框提示
    - 可以输入浮点数
2. 

2.11
1. 伪刺激波形移动存在问题，修改了伪刺激淡入淡出和波形移动的问题。
2.10
1. 当软件缩放达到高度或宽度为0时，出现错误，所以设置wave和mainwindows的minwidth和minheight不为0；
2. 已经检查完成了所有的电话限制信息
3. 在治疗记录中不再显示方案、病种等信息，仅显示刺激本身的具体信息。
4. 治疗记录的时间显示为xx:xx
5. 刺激部位选项添加内容可以选择
6. 更新了wave的显示

1.27
1. 完成了伪刺激模式下限制淡入淡出时间。

1.26 
1. 修改Tdcs部分参数
2. 调整wave两种使用方法进行显示。最后还是将wave调整为使用OnRender的方式进行显示。



1.24
1. 修改tdcs代码的剩余转换信息
2. 修改完成了mainwindow和Control的部分代码更新，尽量使代码解耦合。
3. 使数据库状态位更改。

1.21
1. 完成代码的调整。

1.20
1. 需要完成一部分优化代码的工作内容(已完成了control、main、stim的ViewModel,基本完成了大概的框架，然后需要后续调整数据展示等)，主要需要完成wave和prescription部分的viewmodel的更新。

1.19
1. 优化代码，参考TDCS的形式，使结构更加清晰，重新写USB相关的转换信息
2. 修改了TDCS有关伪刺激时，淡入淡出时间的限制。

1.18
1. 了解一下maui等，沟通关于伪刺激模式下的淡入淡出的问题。

1.17
1. 流文档学习了解。FlowDocument、Paragraph
2. 了解Typography的属性，主要是管理字体、页面排版信息等

1.13
1. 主要进行了调试Tcs代码

1.12
1. 完成了使用C++的测试联调代码进行数据联调，关于同步治疗记录时是否开启查询。
2. Tcs安装路径C盘，导致导出时存在文件被占用，无法正常打开，同时需要增加一个自动添加快捷方式(经过测试，发现只要文件存放在C：programx86下就会被锁定，与程序无关)
3. 学习和了解了设计方法。主要是创建型-》建造者模式

1.11
1. 验证和硬件的联调，查询和同步治疗记录等问题（查询和同步不能同时使用，否则会导致漏包，数据不全）
2. 修复了tcs的问题，selected.eq的状态更新不正确
3. 重写了C++测试代码，使用了usb类的方式。

1.10
1. 完成了初步的组合包代码(验证成功完成)，数据包的粘包和分包操作
2. 验证完成了最大化和最小化的问题
3. 完成了Tcs使用说明书。

1.7
1. 最大化和还原的标反了。
2. 最大化的时候占用了导航栏。
3. 修改了导出时存在的不及时的问题。
4. 制作了软件说明书


1.6
1. Tdcs修改了资源的使用(包括图片和文件)
2. Tcs的使用说明书（未完成）
3. 注册还是保存在window中

1.5
1. 增加了一个治疗记录详情查看页面，显示治疗记录的具体信息。
2. 解决了ToolTip无法正常显示，会使得Content失效的问题。
2. 切换查看方式等？

1.4
1. 完成为刺激的沟通，制作烧录卡片的作业指导书（说明）
2. tdcs的导出被加密的问题等。（增加提示）
3. 增加了事务处理和本地化的信息

12.31
1. 完成了伪刺激的图片的添加和增加标注（并使用了统一的函数进行传入管理）

12.30
1. 协助硬件调试硬件的bug，打印对应的数据，确定问题点（数据包丢失）
2. 修改导出时候的格式和记录中英文转换不对的情况。
3. 收到伪刺激的图，需要根据伪刺激图片增加到程序中
4. 学习了一下高级编程中的安全性和本地化相关的问题。

12.29
1. tdcs
    1. 修改bug，当拔出控制器设备未更新的问题
    2. 修改了wave的remainTime和tbmove/bor的显示使用binding的方式而不是手动设置的方式。
    3. 优化了wave端显示

12.28
1. 修改伪刺激bug

12.27
1. 了解了C#高级编程的Thread Task Parallel

12.24
1. 修复了问题，关于卡片烧录不成功的情况，给出了提示信息和返回机制
2. 了解了TraceSource和Trace的不同，及如何使用TraceSource进行日志记录。

12.23
1. 完成了伪刺激的使用说明书，大概版本。
2. 修改了部分bug，重复点击等。

12.22
1. 已完成tdcs 烧录校准的功能，并增加了烧录状态判定
2. 需要对卡id进行连续简单的烧录，需要修改烧录工具。
3. 完成了对伪刺激软件的打包脚本的修改和适配
4. 更改了发布权限和部分bug

12.21
1. 增加文件过滤器Filter
2. 对于导入治疗记录时，增加了对治疗记录内容的判断
3. page查询跳转显示页面不一致的问题

1. 完善烧录校准的逻辑，使用jlink搭配cmd进行操作(根据修改意见进行修改)
2. 增加了一个烧录设备的连接检测

12.20
1. 完成了tdcs烧录工具里面的广播烧录（使用jlink + cmd的方式进行烧录）
2. 修改伪刺激的bug（部分）
3. 了解反射和特性还有属性的区别和状态更换。

12.17
1. 伪刺激
    1. 完成了查询栏的查找的数据库更新
    2. 完成了烧录逻辑和使用逻辑的调试
    3. 完成双击放大和缩小
    4. 可移动功能
    5. 完成了伪刺激V1.0.0
2. tdcs烧录
    1. 完成了模块命名的限制

12.16
1. 完成伪刺激的数据字段的修正和数据库修改
2. 针对数据库修改后的情况，修正了烧录逻辑和使用参数。（具体的功能显示还在调试中）

12.15
1. 伪刺激
    1. label的交互逻辑的缓慢架构和整理
    2. 调整model的参数和Global的参数逻辑。尽可能的使用模块减少数据耦合和不必要的参数。

2. tdcs
    1. 参数判断存在问题，出现不该出现的红框
    2. 取消暂停和继续
    4. 存在bug点刺激频率调整时出现99.9999999999的现象
    5. 当重复点击的时候必须要等待30s，修改一下这里的逻辑(修改为5s检查时间)

12.14
1. 完成了label卡片数据查询，烧录记录的保存。

12.13
1. 需要完成界面颜色的同步。主要是卡片烧录界面(已完成)
2. 完成了界面上label标签的添加(增加了项目label的选择，确定label的交互思路)
3. 需要在project详情中添加当前项目的状态，如果状态为未完成，已完成（需要显示他的一个烧录的labels和数量）

12.10
1. 需要完成


12.9
1. 插拔需要监控window下的消息机制，了解并熟悉机制
2. 完成了对读卡器的热插拔，实现的原理为使用window消息钩子的方式。
3. 完成了治疗记录的binding,查找的时候无法进行模糊查找，只能输入全拼查找（待优化）
4. project的datagrid也需要查找的updateData。

12.8
1. 需要增加读卡器的自动识别（hid的插入、拔出）
    1. 已经可以读取到所有的usb的信息。
    2. 需要对window设备下的设备插拔做出识别！！！（使用window 钩子）

12.7
1. tdcs修改了部分问题，具体问题可以查看tapd上的信息参数。

12.3
1. 学习了委托相关的内容
2. 将治疗记录管理的datagrid进行设置显示，增加了选择框等信息
3. 完成了导入治疗记录，选择文件，excel的数据解析。

12.2
1. 修改了产品设计方案说明书。
2. 伪刺激User的显示详情内容添加。
3. 制作了页码跳转的功能实现。
4. 医生列表的显示详情。

12.1
1. 完善了User数据库的信息，增删查改
2. 增加了治疗记录的一个数据模型设计，外加进行数据库的增删查改书写。
3. 修改了烧录记录的数据库模型，增删查改。
2. 增加了UserList的页面的设计，增加了页码导航的功能。

11.30
1. 修改和优化了伪刺激的部分格式状态
    1. 单次刺激增加了根据之前的id号进行拷贝输入
    2. 考虑如何进行项目分组，（可能需要对项目内容进行修改）
2. 伪刺激增加了账户管理的popup功能
    1. 增加了一个新建页面
3. 新增了一个ConfirmMessage页面，主要是为了显示控制

11.29
1. 去福永工厂验证V2的工装的功能，没有问题，但是修改了充电电流的值改为random

11.26
1. 修改了Tdcs的bug，大概10几条问题点、
2. 开会确认伪刺激的状态，需要增加分组，然后按照分组烧录，进行一定程度的页面优化。

11.25
1. 为设置tab增加了系统设置的框架。
2. 优化了连续刺激的界面显示，同时增加了一些代码binding关于livechart的显示。
3. 学习了关于C#的相关信息。

11.24
1. 整理伪刺激的代码，然后增加了一个系统设置的显示。
2. 将单次刺激和连续刺激分离开，让程序逻辑更加通畅。

11.23
1. 对于烧录工具，增加了通信一些校准输出命令。(已全部完成)

11.22
1. 对于下位机先改变，上位机需要同步的时候，通信协议需要重新改变
2. 清理下发方案时偏置电流的数组
3. 对于还是偶然发生的上传无法全部上传的问题，debug找到问题点为上传的时间不正确，导致读取的正确数据包错误。
4. 通信协议增加了校准输出命令，在我的烧录工具里面增加校准输出的输出。还有升级命令待办

11.17
1. 对tdcs进行修改为MVVM的格式，同时配合修改参数信息

11.16
1. 完成C#的内存管理的学习和操作。

11.15
1. 完成了使用Tdcs的框架，实现login的MVVM模式下的使用。

11.12
1. 学习完成了command的使用，尽量学会使用前后端分离MVVM的方式进行程序编码
2. 垃圾回收机制的多种方法和内容。包括标记清除法、标记压缩法、标记交换法、引用计数。

11.11
1. 将TDCS的通信协议重新修改回之前的版本，然后将总刺激时间限制到240min，限制它的影响因素的调整。
2. 学习了一下关于C#的垃圾回收机制的东西，写了一份文档
3. 已完成了一个连续刺激的简单版本，需要优化和增加判断语句等。

11.10
1. 完成了伪刺激卡片使用M1卡的功能，
2. 完成了tdcs参数的修改和图标的调整，关于蓝牙信号的图标和电量的图标
3. TDCS的进度条存在bug的相关问题。
4. 学习了一下html和css、js的大概流程。

11.5
1. 重新梳理了部分数据结构，同时检查了进度条设置的max值和value值的binding值是否正确的问题
2. 根据修改后的通信协议，修改了数据转换的信息。
3. 完成了对S50(Mifare 1K)的结构和函数api调用的理解，需要同时修改代码里面的函数调用。

11.4
1. 解决bug，关于当设备正在刺激时，进入上位机会闪退的问题。
2. 增加了信号显示功能。能够显示3/4格信号信息。(尝试使用了png、svg或者自带的控件)
3. 修改显示时间为剩余时间。
2. 交流和修改TDCS软件，修改了部分通信协议，将fes的时间进行修改，增大了时间的范围。

11.3
1. 和硬件人员调试上传功能的使用，完成了图片切换和使用流程显示
2. VS存在问题，尝试解决问题，或者重装VS使用

11.2
1. 添加了图片的显示切换信息,波形图位置调整。

11.1
1. 需要学习嵌入式的基础知识框架，对他有了一个大概的了解（未完成）
2. 对TDCS软件进行优化程序的需求,时间显示更改为小时、分钟、秒的形式、Fes时间保留小数点后2位、由于总时间的更改，调整slider上的max值的更改
3. 对tdcs增加后面几个的显示和移动（未完成），为tdcs方案限制调整
4. 和硬件沟通一下图形显示相关的信息，并需要修改一下波形的参数显示

10.29
1. 对于tdcs的方案的参数进行限制修改,增加了validationRule进行限制

10.28
1. 梳理了伪刺激的结构功能分布，制作了一份软件需求规格书，后续相关的需求和功能待改进梳理
2. 学习了解Mifare Classic 1K的具体操作流程和结构功能布局。（仅部分功能）
3. 制作了Tcs的蓝湖的软件交互逻辑图

10.27
1. 和硬件调试tdcs，上传功能还是存在无法完全上传成功的问题
2. 对于伪刺激，已完成对于格式的部分调整，和使用部分控件，但是还需要调整颜色
3. 确认管理员权限的bug是因为硬件驱动没能正确安装

10.26
1. 修改同步的时候断掉查询的循环，仅使用上传的功能,需要和硬件进行调试
2. 为伪刺激增加了一个单独的工厂生成烧录id的demo功能
3. 为伪刺激增加了一个样式的修改，同时需要修改他的其他显示的适配性

10.25
1. 对于暂停和继续增加一个显示切换
2. 对于Tdcs烧录软件，增加了对她的样式的调整,已完成对它基本内容的调整
3. 学习了关于Material Design In XAML Toolkit的使用

10.21

1. 将fes的部分参数的显示范围进行修改
2. 为串频率、刺激数量、刺激周期增加一个公式限制
3. 增加一个总的刺激时间的显示
4. 当自动测试完成后直接显示开始刺激

1. 增加了一个tdcs的烧录工具的模板，大致理清楚所需步骤和功能

