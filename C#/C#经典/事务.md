## 事务处理阶段
事务处理分为激活、准备和提交3个阶段
- 激活阶段：在这个阶段创建事务。为资源管理事务处理的资源管理器可以进行事务登记。
- 准备阶段：
- 提交阶段：

## ACID特性
1. 原子性（Atomicity）：当事务结束，它对所有资源状态的改变都被视为一个操作。
2. 一致性（Consistency）：当操作完成后，所有数据必须符合业务规则，否则业务中止。
3. 隔离性（Isolation）：事务以相互隔离的方式执行，事务外的实体无法知道事务过程的中间状态。
4. 持久性（Durable）：事务提交后，数据必须以一种持久性方式存储起来。

## 示例
````C#
/// <summary>
        /// 传统的事务处理（数据库）ado.net1.0
        /// </summary>
        /// <param name="connectionString"></param>
        public static void Execute(string connectionString)
        {
            using(SqlConnection connection = new SqlConnection(connectionString))
            {
                connection.Open();

                SqlCommand command = connection.CreateCommand();
                SqlTransaction transaction;

                //启动事务
                transaction = connection.BeginTransaction();

                //设置SqlCommand的事务和连接对象
                command.Connection = connection;
                command.Transaction = transaction;

                try
                {
                    command.CommandText = "Insert Into ";
                    command.CommandType = System.Data.CommandType.Text;
                    command.ExecuteNonQuery();

                    //事务提交
                    transaction.Commit();
                    
                }
                catch(Exception ex)
                {
                    //数据回滚
                    transaction.Rollback();
                    App.trace.TraceData( System.Diagnostics.TraceEventType.Error,3, "事务处理错误" + ex.Message);
                }
            }
        }

        /// <summary>
        /// 使用TransactionScope隐式事务管理 ado.net2.0
        /// </summary>
        public static void Scope()
        {
            try
            {
                using (TransactionScope scope = new TransactionScope(TransactionScopeOption.Required))  //使用事务
                {
                    using (SqlConnection connection = new SqlConnection())
                    {
                        using (SqlCommand command = new SqlCommand())
                        {
                            command.CommandText = "Insert into ";
                            command.CommandType = System.Data.CommandType.Text;
                            command.Connection = connection;
                            connection.Open();
                            command.ExecuteNonQuery();
                        }
                    }
                    using (SqlConnection connection1 = new SqlConnection())
                    {
                        using(SqlCommand command = new SqlCommand())
                        {
                            command.CommandText = "Insert into 2";
                            command.CommandType = System.Data.CommandType.Text;
                            command.Connection = connection1;
                            connection1.Open();
                            command.ExecuteNonQuery();
                        }
                    }
                    scope.Complete();   //结束事务
                    
                }
            }
            catch
            {
                
            }
        }

 /// <summary>
    /// 使用 using System.EnterpriseServices;进行事务处理
    /// 优点是多个对象能够轻松运行在同一事务中，事务还可以自动登记。
    /// 缺点是需要COM+主机模型，使用这个技术的类必须派生自ServicedComponent
    /// </summary>
    [Transaction(TransactionOption.Required)]
    public class CourseData : ServicedComponent
    {
        [AutoComplete]
        public void AddCourse()
        {
            using(SqlConnection connection = new SqlConnection())
            {
                using(SqlCommand command = new SqlCommand())
                {
                    command.CommandText = "Insert into ";
                    command.CommandType = System.Data.CommandType.Text;
                    command.Connection = connection;
                    connection.Open();
                    command.ExecuteNonQuery();
                    connection.Close();
                }
            }
        }
    }
````
